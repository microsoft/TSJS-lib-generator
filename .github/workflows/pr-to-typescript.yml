name: Create PR to TypeScript
on:
  workflow_dispatch: {}

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "lts/*"
          cache: npm

      - run: npm ci
      - run: npm run build
      - run: npm test

      - uses: actions/checkout@v4
        with:
          repository: "microsoft/TypeScript"
          path: "TypeScript"

      - run: |
          # Move the new lib files ins
          node ./deploy/migrate.js ./TypeScript

          # Update the TypeScript test baselines also
          cd TypeScript
          npm i
          gulp runtests-parallel || true
          gulp baseline-accept
          git restore package-lock.json

      - uses: peter-evans/create-pull-request@v6
        with:
          path: TypeScript
          commit-message: "ðŸ¤– Update TypeScript DOM Libs"
          title: "Update TypeScript DOM Libs"
          body: "This PR was generated by @${{ github.actor }} from https://github.com/microsoft/TypeScript-DOM-lib-generator/"
          push-to-fork: typescript-bot/TypeScript
          branch: update-dom
          labels: |
            Domain: lib.d.ts
            Housekeeping
          token: ${{ secrets.TS_GITHUB_BOT_AUTH }}
